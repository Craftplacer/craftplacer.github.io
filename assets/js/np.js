function setNowPlaying(e,n){var t=e.track_metadata,a=buildTextElement(n,"h2",null);a.classList="image-heading",a.innerHTML='<img src="/assets/img/pink/np-header.gif" alt="Now playing">';var r=buildTextElement(n,"p",null),l=null;console.debug(l);var i=null;null!=l?(i=buildTextElement(r,"a",t.track_name+"\n")).href=l:i=buildTextElement(r,"span",t.track_name+"\n"),i.style.fontWeight="bold",buildTextElement(r,"span","by "+t.artist_name+"\n"),null!=t.release_name&&buildTextElement(r,"span","from "+t.release_name),fetchCoverArt(t,n)}function fetchCoverArt(e,t){var a=new XMLHttpRequest;a.onload=function(){var e=JSON.parse(a.responseText),n=document.createElement("img");n.alt="",n.style.width="100%",n.src="https://coverartarchive.org/release/"+e.recordings[0].releases[0].id+"/front-250",n.onerror=function(){t.removeChild(n)},t.appendChild(n)};var n=buildQuery(e);a.open("GET","https://musicbrainz.org/ws/2/recording/?fmt=json&query="+encodeURIComponent(n),!0),a.send()}function buildQuery(e){var n="";return n+='artist:"'+e.artist_name+'" AND',n+='release:"'+e.release_name+'" AND',n+='recording:"'+e.track_name+'"'}function buildTextElement(e,n,t){var a=document.createElement(n);return a.innerText=t,e.appendChild(a),a}function fetchNowPlaying(n){var t=new XMLHttpRequest;t.onload=function(){var e=JSON.parse(t.responseText);0!=e.payload.listens.length&&setNowPlaying(e.payload.listens[0],n)},t.open("GET","https://api.listenbrainz.org/1/user/craftplacer/playing-now",!0),t.send()}window.addEventListener("load",function(){var e=document.getElementById("np-slot");null==e?console.warn("Couldn't find now-playing slot"):fetchNowPlaying(e)});
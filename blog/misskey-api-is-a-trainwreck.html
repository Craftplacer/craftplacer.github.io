<!DOCTYPE html> <html lang="en"> <head> <title>The Misskey API is a trainwreck - craftplacer.moe</title> <style type="text/css">body{margin:0;font-size:11px}.layout{width:936px;width:-moz-fit-content;width:fit-content;margin:0 auto;text-align:center}.layout #main .panel,.layout #nav .panel,.layout #sidebar .panel{margin-bottom:16px}.layout #nav ul{padding-left:20px}.layout #nav li{padding:1px 0;min-height:18px}.layout #nav li *{position:relative;top:-4px}.layout #nav .section{font-weight:bold}.layout>*{display:inline-block;margin:6px}.layout__main,.layout__sidebar{text-align:left;vertical-align:top}.layout__main,.layout__main>*{width:554.4px;max-width:554.4px}.layout__sidebar{width:184.8px;max-width:184.8px}.panel{width:100%}.panel>div{margin:12px}</style> <link rel="stylesheet" type="text/css" href="/assets/css/styles.css"> <link rel="stylesheet" type="text/css" href="/assets/css/pink.css"> <link rel="stylesheet" type="text/css" href="/assets/css/mobile.css"> <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta http-equiv="onion-location" content="http://mwas32ahexpkksf64koqzzascy5epm7tl4evkw5kfcc2un2ufixvxcad.onion/"/> <meta name="generator" content="Jekyll v4.2.2"/> <meta property="og:title" content="The Misskey API is a trainwreck"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Adding support for Misskey was way harder than Mastodon and Pleroma combined."/> <meta property="og:description" content="Adding support for Misskey was way harder than Mastodon and Pleroma combined."/> <link rel="canonical" href="https://craftplacer.moe/blog/misskey-api-is-a-trainwreck"/> <meta property="og:url" content="https://craftplacer.moe/blog/misskey-api-is-a-trainwreck"/> <meta property="og:site_name" content="craftplacer.moe"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2022-05-26T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="The Misskey API is a trainwreck"/> <meta name="twitter:site" content="@Craftplacer"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-26T00:00:00+00:00","datePublished":"2022-05-26T00:00:00+00:00","description":"Adding support for Misskey was way harder than Mastodon and Pleroma combined.","headline":"The Misskey API is a trainwreck","mainEntityOfPage":{"@type":"WebPage","@id":"https://craftplacer.moe/blog/misskey-api-is-a-trainwreck"},"url":"https://craftplacer.moe/blog/misskey-api-is-a-trainwreck"}</script> <link type="application/atom+xml" rel="alternate" href="https://craftplacer.moe/feed.xml" title="craftplacer.moe"/> <link href="https://github.com/Craftplacer" rel="me"> <script src="/assets/js/np.js" async></script> <script src="/assets/js/compat.js" async></script> </head> <body> <div class="layout"> <div id="nav" class="nav layout__sidebar"> <div class="panel"> <a href="/"><img alt="craftplacer.moe" id="banner" src="/assets/img/banner.gif"></a> </div> <div class="panel"> <div> <nav aria-label="Me"> <ul> <li style="list-style-image:url('/assets/img/pink/blog.gif')"> <a href="/blog">Blog</a> </li> <li style="list-style-image:url('/assets/img/pink/diary.gif')"> <a href="/diary">Diary</a> </li> <li style="list-style-image:url('/assets/img/pink/cookbook.gif')"> <a href="/cookbook">Cookbook</a> </li> <li style="list-style-image:url('/assets/img/pink/quotes.gif')"> <a href="/quotes">Things people say about me</a> </li> <li style="list-style-image:url('/assets/img/pink/about.gif')"> <a href="/about-me">About me</a> </li> </ul> </nav> <hr> <nav aria-label="Favorites"> <ul> <li style="list-style-image:url('/assets/img/pink/bullet.gif')"> <a href="/favorites/extensions">Extensions</a> </li> <li style="list-style-image:url('/assets/img/pink/bullet.gif')"> <a href="/favorites/music">Music</a> </li> </ul> </nav> <hr> <nav aria-label="World Wide Web"> <ul> <li style="list-style-image:url('/assets/img/pink/directory.gif')"> <a href="/directory">Directory</a> </li> <li style="list-style-image:url('/assets/img/pink/services.gif')"> <a href="/services">Services</a> </li> </ul> </nav> <hr> <nav aria-label="Projects"> <ul> <li style="list-style-image:url('/assets/img/ico/kaiteki.gif')"> <a href="/projects/kaiteki">Kaiteki</a> </li> <li style="list-style-image:url('/assets/img/pink/bullet.gif')"> <a href="/projects/contributions">Contributions</a> </li> <li style="list-style-image:url('/assets/img/pink/web-design.gif')"> <a href="/projects/web-design">Web design</a> </li> <li style="list-style-image:url('/assets/img/ico/pleroma.gif')"> <a href="/projects/pleroma-user-styles">Pleroma styles</a> </li> </ul> </nav> <hr> <ul> <li style="list-style-image:url('/assets/img/pink/bullet.gif')"> <a href="/guestbook">Guestbook</a> </li> </ul></div> </div> <div class="panel" style="text-align:center"> <div><a href="http://mwas32ahexpkksf64koqzzascy5epm7tl4evkw5kfcc2un2ufixvxcad.onion/"><img src="/assets/img/tor-button.gif" width="104" height="23" alt="Visit Tor Version"></a> <span></span> </div> </div> </div> <div id="main" class="layout__main"> <div id="mobile-nav"><div class="mobile-nav-container"> <a href="/" style="font-weight: bold;">craftplacer.moe</a> <span class="section">Me</span> &bull; <a href="/blog">Blog</a> &bull; <a href="/diary">Diary</a> &bull; <a href="/cookbook">Cookbook</a> &bull; <a href="/quotes">Things people say about me</a> &bull; <a href="/about-me">About me</a> <span class="section">Favorites</span> &bull; <a href="/favorites/extensions">Extensions</a> &bull; <a href="/favorites/music">Music</a> <span class="section">World Wide Web</span> &bull; <a href="/directory">Directory</a> &bull; <a href="/services">Services</a> <span class="section">Projects</span> &bull; <a href="/projects/kaiteki">Kaiteki</a> &bull; <a href="/projects/contributions">Contributions</a> &bull; <a href="/projects/web-design">Web design</a> &bull; <a href="/projects/pleroma-user-styles">Pleroma styles</a> <a href="/guestbook">Guestbook</a> </div></div> <div id="content" class="layout__content"><div class="panel"> <div class="article"> <article> <h1>The Misskey API is a trainwreck</h1> <p><b>Published on:</b> <time datetime="2022-05-26 00:00:00+00:00">26 May 2022</time></p> <p>Adding support for Misskey was way harder than Mastodon and Pleroma combined.</p> <p>For context, I am developing Kaiteki, my attempt at building the “best” Fediverse (and by far extension, social media) client.</p> <h2 id="the-api-breaks-several-conventions">The API breaks several conventions</h2> <p>Normally, developing API is pretty standardized because everyone is using REST. Misskey inherits the design of the <a href="https://developer.twitter.com/en/docs/twitter-api/v1/tweets/post-and-engage/overview">outdated Twitter v1 API</a> and goes beyond that. ‘How?’ you may ask? <strong>All</strong> requests are made using <code class="language-plaintext highlighter-rouge">POST</code>.</p> <p>Compared to ‘normal’ APIs, you’d send a <code class="language-plaintext highlighter-rouge">GET</code> request to <code class="language-plaintext highlighter-rouge">/items</code> to get a list of items, send a <code class="language-plaintext highlighter-rouge">POST</code> request to <code class="language-plaintext highlighter-rouge">/items</code> to add an item to the list, and so on.</p> <p>Misskey on the other hand, uses <code class="language-plaintext highlighter-rouge">POST</code> for each request, while tacking on an action verb to the end of each endpoint (e.g. <code class="language-plaintext highlighter-rouge">/items/create</code>), reminiscent of <abbr title="Remote Procedure Call, basically functions that can be called by remote appliactions">RPC</abbr>.</p> <p>Another convention that is broken is how authorization is handled in APIs. The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization"><code class="language-plaintext highlighter-rouge">Authorization</code> HTTP header</a> exists for a reason. It’s role is to authorize the request. Misskey instead includes the token in the request body as a field called <code class="language-plaintext highlighter-rouge">i</code>. This has caused me to commit my Misskey token once due to me not knowing what that omnious <code class="language-plaintext highlighter-rouge">i</code> stood for. It’s like your maths teacher asking you to solve for <code class="language-plaintext highlighter-rouge">x</code> for the first time.</p> <h2 id="schemas-lack-organization-and-are-bloated">Schemas lack organization and are bloated</h2> <p>Taking the <a href="https://misskey.io/api-doc#operation/users/show">user schema</a> as an example (which apparently uses “one of”s, which also broke ApiToDart, thanks for that) we can see an insane list of fields define when looking at <code class="language-plaintext highlighter-rouge">MeDetailed</code>.</p> <p>I don’t know why the developers didn’t group flags together to another schema, so maybe they could be reused, in a more sensible way. For example, we could’ve taken <code class="language-plaintext highlighter-rouge">isAdmin</code>, <code class="language-plaintext highlighter-rouge">isModeartor</code> and put it inside a schema called something around the lines of <code class="language-plaintext highlighter-rouge">UserStaffFlags</code>. The same could’ve been done for <code class="language-plaintext highlighter-rouge">isCat</code> and <code class="language-plaintext highlighter-rouge">isBot</code>.</p> <p>Comparing to Pleroma, Pleroma has <a href="https://api.pleroma.social/#operation/AccountController.relationships">a schema called a relationship</a>.</p> <h2 id="the-api-is-poorly-documented">The API is poorly documented</h2> <p>Misskey’s API documentation and schemas are <a href="https://github.com/misskey-dev/misskey/blob/develop/packages/backend/src/server/api/openapi/gen-spec.ts">generated using an in-house tool</a>, which works for most cases, but not all.</p> <p>Going back to Kaiteki, I want to future-proof the code as much as possible. That means, things like having to handwrite each <abbr title="class that holds data for use across the application">model class</abbr> is a no-go. This task has been automated by me with a tool call <a href="https://github.com/Kaiteki-Fedi/ApiToDart">ApiToDart</a>, which generates code using the specifications/documentation offered by each backend.</p> <p>My solution for Kaiteki’s longevity falls apart with Misskey. There have been several issues:</p> <ul> <li>The schemas lying about whether a property is null or not <ul> <li>requires me manually specifying it</li> </ul> </li> <li>The documentation is incomplete, some fields being defined as plain “objects” with no details whatsoever.</li> <li> <p>The generated schema always assumes JSON and not other form data like multipart.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
</span><span class="nl">"reactions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"nullable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
</span></code></pre></div> </div> </li> </ul> <p>This poor documentation ends up in me sending requests over the official frontend and peeking with my browser’s developer tools. This is also how Kaiteki uses the private <code class="language-plaintext highlighter-rouge">sign-in</code> endpoint which has been <a href="https://github.com/misskey-dev/misskey/tree/develop/packages/backend/src/server/api/private">explicitly removed</a> from the documentation.</p> <h2 id="will-something-ever-change">Will something ever change?</h2> <p>While I despise Misskey’s userbase, I still try to be fair about it. But the API is, like mentioned above, objectively bad. I am not the single one sharing that opinion, with a1batross (former developer of Husky) saying “at this point it’s Misskey [that] must be patched to support your client”.</p> <p>It’s as if Syuilo actively doesn’t cares about third-party applications, like Kaiteki.</p> <p>It’s easy to complain while doing nothing. But at the same time, I don’t have 100 copies of myself to contribute to every piece of software I don’t like to fix it up to the way I like it (taking Linux software as an example). Except creating an easily forgotten issue on their repository that can be easily dismissed, I don’t think there is much hope.</p> </article> </div> </div> <script id="comments" src="/assets/js/comments.js"></script> </div> <footer><div id="footer" class="panel"> <div><p class="light-text">This page was generated on 2022-10-10 02:09 with commit </p> <p class="light-text"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img class="web-button--small" alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" src="/assets/img/80x15/cc/by-nc-sa.png"/></a> • <a href="/sitemap.xml">Sitemap</a> • <a href="/credits">Credits</a> • <a href="/about-site">About this site</a></p></div> </div></footer> </div> <div id="sidebar" class="layout__sidebar"> <div class="panel"> <div><div style="text-align:center"><div id="fediring"> <a href="https://fediring.net/previous?host=craftplacer.moe"><img alt="Previous" src="/assets/img/pink/fediring-nav/previous.png" width="20" height="20"></a><a href="https://fediring.net/"><img alt="Fediverse Webring" src="/assets/img/pink/fediring-nav/middle.png" width="79" height="20"></a><a href="https://fediring.net/next?host=craftplacer.moe"><img alt="Next" src="/assets/img/pink/fediring-nav/next.png" width="19" height="20"></a> </div></div> <p> Feeling... <a href="https://www.imood.com/users/Craftplacer"><img src="https://moods.imood.com/display/uname-Craftplacer/fg-EF7094/bg-FFF7F7/imood.gif" alt="The current mood of Craftplacer at www.imood.com" id="imood"></a> </p> <h2 class="image-heading"><img src="/assets/img/pink/friends-header.gif" alt="Friends"></h2> <p>(insert buttons here)</p> <div id="np-slot"> </div> </div> </div> </div> </div> <img id="kyouko" src="/assets/img/kyouko.gif" width="300" height="505" aria-hidden="true" alt=""> </body> </html>